# üóÑÔ∏è Database Backup Guide

**–°–æ–∑–¥–∞–Ω–æ:** 27 –æ–∫—Ç—è–±—Ä—è 2025
**–°—Ç–∞—Ç—É—Å:** Production Ready
**–ê–≤—Ç–æ—Ä:** PulseAI Team

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
- [–°–æ–∑–¥–∞–Ω–∏–µ backup](#—Å–æ–∑–¥–∞–Ω–∏–µ-backup)
- [–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ backup](#–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ-–∏–∑-backup)
- [–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è](#–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è)
- [Troubleshooting](#troubleshooting)

---

## üîç –û–±–∑–æ—Ä

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PulseAI.

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- ‚úÖ –°–∂–∞—Ç–∏–µ backup (gzip)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö backup (30 –¥–Ω–µ–π)
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞ –æ–¥–Ω—É –∫–æ–º–∞–Ω–¥—É
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Supabase PostgreSQL

**–§–∞–π–ª—ã:**
- `scripts/backup_db.sh` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ backup
- `scripts/restore_db.sh` ‚Äî –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ backup
- `backups/` ‚Äî –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è backup

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –°—Ç–∞—Ä—Ç

### 1. –°–æ–∑–¥–∞—Ç—å backup:

```bash
./scripts/backup_db.sh
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úÖ Backup created: backups/pulseai_20251027_143022.sql.gz
Size: 2.5M
```

### 2. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ backup:

```bash
./scripts/restore_db.sh backups/pulseai_20251027_143022.sql.gz
```

---

## üíæ –°–æ–∑–¥–∞–Ω–∏–µ Backup

### –†—É—á–Ω–æ–π Backup

```bash
# Basic usage
./scripts/backup_db.sh

# Custom backup directory
./scripts/backup_db.sh /path/to/custom/backups
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π Backup (Cron)

–î–æ–±–∞–≤–∏—Ç—å –≤ crontab –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ backup –≤ 3:00:

```bash
# Open crontab
crontab -e

# Add this line (adjust path):
0 3 * * * cd /Users/denisfedko/news_ai_bot && ./scripts/backup_db.sh >> logs/backup.log 2>&1
```

**–° —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –ª–æ–≥–æ–≤:**
```bash
# Backup —Å –ª–æ–≥–æ–º
0 3 * * * cd /Users/denisfedko/news_ai_bot && ./scripts/backup_db.sh >> logs/backup_$(date +\%Y\%m\%d).log 2>&1
```

### Backup –ú–µ—Ç—Ä–∏–∫–∏

**–†–∞–∑–º–µ—Ä backup:** ~2-10 MB (—Å–∂–∞—Ç—ã–π)
**–í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è:** ~10-30 —Å–µ–∫—É–Ω–¥
**–•—Ä–∞–Ω–µ–Ω–∏–µ:** –ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π
**–ê–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ:** –î–∞ (—Å—Ç–∞—Ä—ã–µ backup —É–¥–∞–ª—è—é—Ç—Å—è)

---

## üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ Backup

### –ë–∞–∑–æ–≤–æ–µ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

```bash
./scripts/restore_db.sh backups/pulseai_20251027_143022.sql.gz
```

**‚ö†Ô∏è WARNING:** –≠—Ç–æ –∑–∞–º–µ–Ω–∏—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ –≤ –ë–î!
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –°–¥–µ–ª–∞–π—Ç–µ backup —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–µ—Ä–µ–¥ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º.

### –ü—Ä–æ—Ü–µ—Å—Å –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–∞:**
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ backup —Ñ–∞–π–ª–∞
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ñ–æ—Ä–º–∞—Ç (.sql.gz)

2. **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ:**
   - –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ (yes/no)
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ backup

3. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:**
   - –ò–∑–≤–ª–µ–∫–∞–µ—Ç SQL –∏–∑ .gz
   - –í—ã–ø–æ–ª–Ω—è–µ—Ç SQL –∫–æ–º–∞–Ω–¥—ã –≤ –ë–î
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å

4. **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ:**
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Å–ø–µ—à–Ω–æ—Å—Ç—å
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç

---

## ‚öôÔ∏è –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

### Cron Job Setup

#### –í–∞—Ä–∏–∞–Ω—Ç 1: –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π backup –≤ 3:00 AM

```bash
# –î–æ–±–∞–≤–∏—Ç—å –≤ crontab
0 3 * * * cd /Users/denisfedko/news_ai_bot && ./scripts/backup_db.sh >> logs/backup.log 2>&1
```

#### –í–∞—Ä–∏–∞–Ω—Ç 2: Backup –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤

```bash
0 */6 * * * cd /Users/denisfedko/news_ai_bot && ./scripts/backup_db.sh >> logs/backup.log 2>&1
```

#### –í–∞—Ä–∏–∞–Ω—Ç 3: Backup —Ä–∞–∑ –≤ —á–∞—Å (–¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö)

```bash
0 * * * * cd /Users/denisfedko/news_ai_bot && ./scripts/backup_db.sh >> logs/backup.log 2>&1
```

### Monitoring Backup

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ backup:**
```bash
ls -lh backups/pulseai_*.sql.gz | tail -5
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å cron job:**
```bash
crontab -l | grep backup_db
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:**
```bash
tail -f logs/backup.log
```

---

## üîß Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: "Command not found: pg_dump"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å PostgreSQL client
# macOS:
brew install postgresql

# Ubuntu/Debian:
sudo apt-get install postgresql-client

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å:
pg_dump --version
```

### –ü—Ä–æ–±–ª–µ–º–∞: "SUPABASE_URL and SUPABASE_KEY must be set"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å .env
cat .env | grep SUPABASE

# –ï—Å–ª–∏ –ø—É—Å—Ç–æ, –¥–æ–±–∞–≤–∏—Ç—å –≤ .env:
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_KEY=your-anon-key
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Connection refused"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Supabase
ping db.supabase.co

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å credentials
echo $SUPABASE_URL
echo $SUPABASE_KEY
```

### –ü—Ä–æ–±–ª–µ–º–∞: "permission denied"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –î–∞—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
chmod +x scripts/backup_db.sh
chmod +x scripts/restore_db.sh
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Backup corrupted"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å backup
gunzip -t backups/pulseai_20251027_143022.sql.gz

# –ï—Å–ª–∏ OK, backup –Ω–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω
# –ï—Å–ª–∏ ERROR, backup –ø–æ–≤—Ä–µ–∂–¥–µ–Ω - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥—Ä—É–≥–æ–π backup
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Backup

### –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö Backup

```bash
ls -lh backups/pulseai_*.sql.gz
```

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**
```
-rw-r--r--  1 user  staff   2.5M Oct 27 14:30 pulseai_20251027_143022.sql.gz
-rw-r--r--  1 user  staff   2.5M Oct 26 14:30 pulseai_20251026_143022.sql.gz
-rw-r--r--  1 user  staff   2.5M Oct 25 14:30 pulseai_20251025_143022.sql.gz
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ Backup

```bash
du -sh backups/
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç—ã –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ Backup

```bash
ls -lt backups/ | head -5
```

---

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –•—Ä–∞–Ω–µ–Ω–∏–µ Backup

‚úÖ **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:**
- –õ–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
- –®–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–∏—Å–∫
- –û—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –¥–ª—è backup
- S3 –∏–ª–∏ –¥—Ä—É–≥–æ–π –æ–±–ª–∞—á–Ω—ã–π storage

‚ùå **–ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:**
- –•—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ production —Å–µ—Ä–≤–µ—Ä–µ
- –ù–µ–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ backup
- BackÏóÖ –±–µ–∑ –ø–∞—Ä–æ–ª–µ–π

### –†–æ—Ç–∞—Ü–∏—è Backup

**–¢–µ–∫—É—â–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞:**
- –•—Ä–∞–Ω–∏—Ç—å: –ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π
- –£–¥–∞–ª—è—Ç—å: –°—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π
- –†–∞–∑–º–µ—Ä: ~75 MB (30 –¥–Ω–µ–π √ó 2.5 MB)

**–î–ª—è production:**
```bash
# –•—Ä–∞–Ω–∏—Ç—å 90 –¥–Ω–µ–π –≤–º–µ—Å—Ç–æ 30
# –ò–∑–º–µ–Ω–∏—Ç—å –≤ backup_db.sh:
KEEP_DAYS=90
```

---

## üìù Best Practices

### 1. –†–µ–≥—É–ª—è—Ä–Ω—ã–µ Backup

- **–ï–∂–µ–¥–Ω–µ–≤–Ω–æ** –¥–ª—è production
- **–ö–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤** –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **–ü–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏—è–º–∏** –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ

### 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Restore

**–ù–µ —Ä–µ–∂–µ —Ä–∞–∑–∞ –≤ –º–µ—Å—è—Ü:**
```bash
# –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –ë–î
createdb pulseai_test

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å backup –≤ test –ë–î
gunzip < backups/pulseai_20251027_143022.sql.gz | psql -d pulseai_test
```

### 3. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ Backup

**–•—Ä–∞–Ω–∏—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö:**
- –õ–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
- –û–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- CD/DVD (–¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö)

### 4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**–û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å:**
- –£—Å–ø–µ—à–Ω–æ—Å—Ç—å backup
- –†–∞–∑–º–µ—Ä backup
- –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ backup
- –û—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö

---

## üéØ Production Checklist

- [ ] Backup –Ω–∞—Å—Ç—Ä–æ–µ–Ω (cron job)
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ restore –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
- [ ] –õ–æ–≥–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –ü–ª–∞–Ω –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω
- [ ] Team –æ–±—É—á–µ–Ω –ø—Ä–æ—Ü–µ–¥—É—Ä–∞–º

---

## üìû Support

**–ü—Ä–æ–±–ª–µ–º—ã —Å backup?**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `tail -f logs/backup.log`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å credentials: `cat .env | grep SUPABASE`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞: `ls -l scripts/backup_db.sh`

**–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç?**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç backup: `file backups/pulseai_*.sql.gz`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: `psql -h db.supabase.co -U postgres -d pulseai`
3. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–π backup

---

**–î–∞—Ç–∞:** 27 –æ–∫—Ç—è–±—Ä—è 2025
**–í–µ—Ä—Å–∏—è:** 1.0
**–°—Ç–∞—Ç—É—Å:** Production Ready
