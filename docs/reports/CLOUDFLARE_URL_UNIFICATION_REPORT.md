# –û—Ç—á—ë—Ç: –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è Cloudflare URL

**–î–∞—Ç–∞:** 14 –æ–∫—Ç—è–±—Ä—è 2025  
**–ê–≤—Ç–æ—Ä:** PulseAI Team  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ

## üìã –°—É—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–π

–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Cloudflare Tunnel URL —á–µ—Ä–µ–∑ **–µ–¥–∏–Ω—É—é —Ç–æ—á–∫—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**. –¢–µ–ø–µ—Ä—å URL –º–µ–Ω—è–µ—Ç—Å—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ, –∞ –Ω–µ –≤ 8+ —Ñ–∞–π–ª–∞—Ö.

## üéØ –ü—Ä–æ–±–ª–µ–º–∞ (–î–æ)

Cloudflare URL –±—ã–ª —Ö–∞—Ä–¥–∫–æ–¥–µ–Ω –≤ **8 –º–µ—Å—Ç–∞—Ö**:

1. ‚ùå `webapp/index.html:20` - preconnect —Ö–∞—Ä–¥–∫–æ–¥
2. ‚ùå `webapp/vite.config.ts:26` - allowedHosts —Ö–∞—Ä–¥–∫–æ–¥  
3. ‚ùå `webapp/src/pages/EventsPage.tsx:58,78` - fetch —Å –ø–æ–ª–Ω—ã–º URL
4. ‚ùå `src/webapp.py:103-104,119` - CORS origins —Ö–∞—Ä–¥–∫–æ–¥
5. ‚ùå `check_processes.sh:222-223` - —Ñ–æ–ª–ª–±—ç–∫ URL

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ü—Ä–∏ —Å–º–µ–Ω–µ URL –Ω—É–∂–Ω–æ –±—ã–ª–æ –ø—Ä–∞–≤–∏—Ç—å 5+ —Ñ–∞–π–ª–æ–≤
- –†–∏—Å–∫ –∑–∞–±—ã—Ç—å –æ–±–Ω–æ–≤–∏—Ç—å –∫–∞–∫–æ–π-—Ç–æ —Ñ–∞–π–ª
- –ù–µ—Ç –µ–¥–∏–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∏—Å—Ç–∏–Ω—ã
- –°–ª–æ–∂–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞

## ‚úÖ –†–µ—à–µ–Ω–∏–µ (–ü–æ—Å–ª–µ)

### 1. –°–æ–∑–¥–∞–Ω Backend API endpoint
**–§–∞–π–ª:** `routes/config_routes.py` (–Ω–æ–≤—ã–π)
- Endpoint: `GET /api/config/urls`
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ URL –∏–∑ `config/core/cloudflare.py`
- –ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø (–±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏)

```python
{
  "status": "success",
  "data": {
    "tunnel_url": "https://...",
    "webapp_url": "https://.../webapp",
    "api_url": "https://...",
    "allowed_hosts": [...]
  }
}
```

### 2. –°–æ–∑–¥–∞–Ω React —Ö—É–∫ –¥–ª—è –∫–æ–Ω—Ñ–∏–≥–∞
**–§–∞–π–ª:** `webapp/src/hooks/useApiConfig.ts` (–Ω–æ–≤—ã–π)
- –ü–æ–ª—É—á–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥ –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ö—ç—à–∏—Ä—É–µ—Ç –≤ localStorage –Ω–∞ 5 –º–∏–Ω—É—Ç
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

### 3. –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ —Ö–∞—Ä–¥–∫–æ–¥—ã

#### Backend (`src/webapp.py`)
- ‚úÖ CORS origins: —Ç–µ–ø–µ—Ä—å —á–∏—Ç–∞–µ—Ç –∏–∑ `CLOUDFLARE_TUNNEL_URL`
- ‚úÖ CSP policy: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –≤–º–µ—Å—Ç–æ —Ö–∞—Ä–¥–∫–æ–¥–∞
- ‚úÖ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω `config_bp` blueprint
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `/api/config` –≤ –ø—É–±–ª–∏—á–Ω—ã–µ –ø—É—Ç–∏

#### Frontend
**`webapp/src/pages/EventsPage.tsx`:**
```typescript
// –ë—ã–ª–æ:
fetch('https://scoring-side-receives-hudson.trycloudflare.com/api/events/...')

// –°—Ç–∞–ª–æ:
fetch('/api/events/...') // –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å
```

**`webapp/vite.config.ts`:**
```typescript
// –¢–µ–ø–µ—Ä—å —á–∏—Ç–∞–µ—Ç –∏–∑ .env:
const env = loadEnv(mode, process.cwd(), '')
const cloudflareUrl = env.VITE_CLOUDFLARE_TUNNEL_URL || env.CLOUDFLARE_TUNNEL_URL
const cloudflareDomain = cloudflareUrl.replace('https://', '')

allowedHosts: [
  'localhost',
  '127.0.0.1',
  cloudflareDomain,  // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏!
  '.trycloudflare.com'
]
```

**`webapp/index.html`:**
```html
<!-- –£–¥–∞–ª—ë–Ω —Ö–∞—Ä–¥–∫–æ–¥ preconnect –¥–ª—è Cloudflare -->
<!-- URL –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ /api/config/urls -->
```

#### Scripts (`check_processes.sh`)
```bash
# –¢–µ–ø–µ—Ä—å —á–∏—Ç–∞–µ—Ç –Ω–∞–ø—Ä—è–º—É—é –∏–∑ config/core/cloudflare.py:
from config.core.cloudflare import CLOUDFLARE_TUNNEL_URL
print(CLOUDFLARE_TUNNEL_URL)
```

### 4. –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**`README.md`:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è "‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Cloudflare Tunnel"
- ‚úÖ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Å–º–µ–Ω–µ URL
- ‚úÖ –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –º–µ—Å—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**`webapp/README.md`:**
- ‚úÖ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ .env –¥–ª—è Vite
- ‚úÖ –ü–æ—è—Å–Ω–µ–Ω–∏–µ, —á—Ç–æ .env –æ–ø—Ü–∏–æ–Ω–∞–ª–µ–Ω –≤ dev —Ä–µ–∂–∏–º–µ

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ò—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã
```
.env —Ñ–∞–π–ª
   ‚Üì
config/core/cloudflare.py
   ‚Üì
   ‚îú‚îÄ‚Üí Backend (webapp.py, routes)
   ‚îú‚îÄ‚Üí Frontend (—á–µ—Ä–µ–∑ /api/config/urls)
   ‚îú‚îÄ‚Üí Vite (—á–µ—Ä–µ–∑ loadEnv)
   ‚îú‚îÄ‚Üí Scripts (check_processes.sh)
   ‚îî‚îÄ‚Üí Telegram Bot (—á–µ—Ä–µ–∑ settings.py)
```

### –ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å URL —Ç–µ–ø–µ—Ä—å

1. **–û–±–Ω–æ–≤–∏—Ç—å .env:**
   ```bash
   CLOUDFLARE_TUNNEL_URL=https://new-url.trycloudflare.com
   ```

2. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã:**
   ```bash
   ./stop_services.sh
   ./start_services.sh
   ```

3. **–ì–æ—Ç–æ–≤–æ!** ‚ú®

–ë–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–æ:
- ‚ùå –ú–µ–Ω—è—Ç—å index.html
- ‚ùå –ú–µ–Ω—è—Ç—å vite.config.ts
- ‚ùå –ú–µ–Ω—è—Ç—å EventsPage.tsx
- ‚ùå –ú–µ–Ω—è—Ç—å webapp.py
- ‚ùå –ú–µ–Ω—è—Ç—å check_processes.sh

## üîç –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã (2)
- ‚úÖ `routes/config_routes.py` - API endpoint –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- ‚úÖ `webapp/src/hooks/useApiConfig.ts` - React —Ö—É–∫ –¥–ª—è –∫–æ–Ω—Ñ–∏–≥–∞

### –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (7)
- ‚úÖ `src/webapp.py` - CORS, CSP, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è blueprint
- ‚úÖ `webapp/src/pages/EventsPage.tsx` - –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏ –≤–º–µ—Å—Ç–æ –ø–æ–ª–Ω—ã—Ö URL
- ‚úÖ `webapp/vite.config.ts` - —á—Ç–µ–Ω–∏–µ allowedHosts –∏–∑ .env
- ‚úÖ `webapp/index.html` - —É–±—Ä–∞–Ω —Ö–∞—Ä–¥–∫–æ–¥ preconnect
- ‚úÖ `check_processes.sh` - —á—Ç–µ–Ω–∏–µ URL –∏–∑ cloudflare.py
- ‚úÖ `README.md` - –Ω–æ–≤–∞—è —Å–µ–∫—Ü–∏—è –æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- ‚úÖ `webapp/README.md` - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ .env

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞

### –õ–∏–Ω—Ç–µ—Ä
- ‚úÖ –í—Å–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã
- ‚úÖ –¢–æ–ª—å–∫–æ 1 –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ (–ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –≤ –∫–æ–Ω—Ü–µ - –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- ‚úÖ –°–ª–µ–¥—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø—É DRY (Don't Repeat Yourself)
- ‚úÖ –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
- ‚úÖ –ü—É–±–ª–∏—á–Ω—ã–π API endpoint (–±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏)

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚úÖ –ù–µ—Ç —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ –∫–æ–¥–µ
- ‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ .env
- ‚úÖ CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ CSP policy –æ–±–Ω–æ–≤–ª–µ–Ω–∞

### UX
- ‚úÖ –ü—Ä–æ–∑—Ä–∞—á–Ω–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∏ –≤ dev, –∏ –≤ production
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ –ø—Ä–∏ —Å–º–µ–Ω–µ URL (runtime config)
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–∞ –Ω–∞ 5 –º–∏–Ω—É—Ç

## üìù –ß—Ç–æ –¥–∞–ª—å—à–µ

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
1. **–°–æ–∑–¥–∞—Ç—å .env —Ñ–∞–π–ª** –≤ `config_files/environment/.env`:
   ```
   CLOUDFLARE_TUNNEL_URL=https://your-url.trycloudflare.com
   ```

2. **–î–ª—è Vite (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)** —Å–æ–∑–¥–∞—Ç—å `.env` –≤ `webapp/`:
   ```
   VITE_CLOUDFLARE_TUNNEL_URL=https://your-url.trycloudflare.com
   ```

3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** —Å–º–µ–Ω—É URL:
   ```bash
   # –ò–∑–º–µ–Ω–∏—Ç—å URL –≤ .env
   # –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
   ./stop_services.sh && ./start_services.sh
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ endpoints
   ```

### Future improvements
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ Vite –∫–æ–Ω—Ñ–∏–≥–∞ —á–µ—Ä–µ–∑ `scripts/generate_vite_config.py`
- [ ] Health check –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Cloudflare URL
- [ ] UI –≤ –∞–¥–º–∏–Ω–∫–µ –¥–ª—è —Å–º–µ–Ω—ã URL –±–µ–∑ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è .env

## üéâ –ò—Ç–æ–≥

**–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞!** üöÄ

- ‚úÖ Cloudflare URL —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∏–∑ **–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞**
- ‚úÖ –í—Å–µ —Ñ–∞–π–ª—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç **–µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫**
- ‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** –ø–æ–ª–Ω–∞—è –∏ –∞–∫—Ç—É–∞–ª—å–Ω–∞—è
- ‚úÖ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** —á–∏—Å—Ç–∞—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–∞—è

–¢–µ–ø–µ—Ä—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ URL –∑–∞–Ω–∏–º–∞–µ—Ç **1 –º–∏–Ω—É—Ç—É** –≤–º–µ—Å—Ç–æ **15-20 –º–∏–Ω—É—Ç** –ø–æ–∏—Å–∫–∞ –∏ –ø—Ä–∞–≤–∫–∏ —Ñ–∞–π–ª–æ–≤! üéØ

