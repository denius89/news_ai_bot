# üåê PulseAI Infrastructure Guide

*–û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏*  
*–û–±–Ω–æ–≤–ª–µ–Ω–æ: 2025-10-08 09:38:39*

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [Cloudflare Configuration](#cloudflare-configuration)
- [Deployment](#deployment)
- [Database Maintenance](#database-maintenance)
- [Monitoring](#monitoring)
- [Security](#security)

## üåê Cloudflare Configuration

### –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Cloudflare Tunnel —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –µ–¥–∏–Ω—ã–π —Ñ–∞–π–ª `config/cloudflare.py`.

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- **CLOUDFLARE_TUNNEL_URL** - –ü—É–±–ª–∏—á–Ω—ã–π URL —Ç—É–Ω–Ω–µ–ª—è
- **CLOUDFLARE_LOCAL_URL** - –õ–æ–∫–∞–ª—å–Ω—ã–π URL –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π

### –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```bash
# –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
make cloudflare-config

# –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
make update-config
```

## üöÄ Deployment

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞:
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt
npm install --prefix webapp

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
make start
```

### Production —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ:
```bash
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Cloudflare Tunnel
make cloudflare-config

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
make update-config

# –ó–∞–ø—É—Å–∫ –≤ production —Ä–µ–∂–∏–º–µ
APP_ENV=production make start
```

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:
```
Cloudflare Tunnel ‚Üí Flask:8001 ‚Üí React Static + API
```

## üóÑÔ∏è Database Maintenance

### –ú–∏–≥—Ä–∞—Ü–∏–∏:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
- –†—É—á–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç—ã
- –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

### –ë—ç–∫–∞–ø—ã:
- –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã
- –†—É—á–Ω—ã–µ –±—ç–∫–∞–ø—ã –ø–µ—Ä–µ–¥ –≤–∞–∂–Ω—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–æ–≤

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
- –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö

## üìä Monitoring

### –ú–µ—Ç—Ä–∏–∫–∏:
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å API
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
- –û—à–∏–±–∫–∏ –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏
- –†–∞–∑–ª–∏—á–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Å–±–æ—Ä –ª–æ–≥–æ–≤

## üîí Security

### Telegram WebApp Authentication Flow

PulseAI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é —á–µ—Ä–µ–∑ Telegram WebApp —Å HMAC SHA256 –ø—Ä–æ–≤–µ—Ä–∫–æ–π:

```python
# 1. –ü–æ–ª—É—á–µ–Ω–∏–µ initData –æ—Ç Telegram WebApp
init_data = request.headers.get('X-Telegram-Init-Data')

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ HMAC SHA256
verified_data = verify_telegram_webapp_data(init_data, bot_token)

# 3. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
if verified_data:
    user_data = extract_user_from_verified_data(verified_data)
```

### Name Normalization System

–°–∏—Å—Ç–µ–º–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–º—ë–Ω –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç:
- Emoji-only –∏–º—ë–Ω: `üî•üî•üî•` ‚Üí `User #<user_id>`
- –ù–µ–≤–∏–¥–∏–º—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤: `John\u200bDoe` ‚Üí `JohnDoe`
- –°—Ç–∏–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö Unicode: `ùïÄùïßùïíùïü` ‚Üí `Ivan`
- –ò—Å–ø–æ—Ä—á–µ–Ω–Ω–æ–π –∫–æ–¥–∏—Ä–æ–≤–∫–∏: `√ê√ê¬∞√ê¬Ω` ‚Üí `–ò–≤–∞–Ω`

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
- **HMAC SHA256** - –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö Telegram
- **HTTPS everywhere** - –≤—Å–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã
- **Session security** - –∑–∞—â–∏—â—ë–Ω–Ω—ã–µ –∫—É–∫–∏ –∏ —Å–µ—Å—Å–∏–∏
- **CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –ø–æ –¥–æ–º–µ–Ω–∞–º
- **Environment variables** - —Å–µ–∫—Ä–µ—Ç—ã –Ω–µ –≤ –∫–æ–¥–µ
- **Database security** - –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
```bash
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
TELEGRAM_BOT_TOKEN=your_bot_token
FLASK_SECRET_KEY=your_secret_key_32_chars_min
SUPABASE_URL=your_supabase_url
SUPABASE_KEY=your_supabase_key
```

### Flask Session Configuration:
```python
app.config.update(
    SECRET_KEY=os.getenv('FLASK_SECRET_KEY'),
    SESSION_COOKIE_HTTPONLY=True,      # –ó–∞—â–∏—Ç–∞ –æ—Ç XSS
    SESSION_COOKIE_SECURE=True,        # –¢–æ–ª—å–∫–æ HTTPS
    SESSION_COOKIE_SAMESITE='Lax',     # –ó–∞—â–∏—Ç–∞ –æ—Ç CSRF
    PERMANENT_SESSION_LIFETIME=timedelta(hours=24)
)
```

### CORS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
```python
CORS(app, origins=[
    "https://*.trycloudflare.com",
    "https://telegram.org",
    "https://web.telegram.org",
    "https://t.me"
])
```

### Security Monitoring:
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞
- –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- –†–µ–≥—É–ª—è—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### API Keys:
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
- –†–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–µ–π
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –î–æ—Å—Ç—É–ø:
- –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –∫ API
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π

–ü–æ–¥—Ä–æ–±–Ω–µ–µ —Å–º. [SECURITY.md](../SECURITY.md)

---

*–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ CLOUDFLARE_CONFIG.md, DEPLOY.md –∏ DATABASE_MAINTENANCE.md*
