# üì∞ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –¥–∞–π–¥–∂–µ—Å—Ç–∞–º PulseAI

## –û–±–∑–æ—Ä

PulseAI –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Å–∏—Å—Ç–µ–º—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤ –Ω–æ–≤–æ—Å—Ç–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º Telegram –±–æ—Ç–∞.

---

## üöÄ Daily Digests Sender

### –û–ø–∏—Å–∞–Ω–∏–µ
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤ –Ω–æ–≤–æ—Å—Ç–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º Telegram –±–æ—Ç–∞.

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

1. **–ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** ‚Äî –∏–∑ NotificationService (digest, enabled, frequency=daily)
2. **–°–±–æ—Ä –ø–æ–¥–ø–∏—Å–æ–∫** ‚Äî –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ SubscriptionService
3. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ—Å—Ç–µ–π** ‚Äî –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –ø–æ–¥–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
4. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤** ‚Äî —á–µ—Ä–µ–∑ DigestAIService —Å –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–µ–π
5. **–û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram** ‚Äî —á–µ—Ä–µ–∑ Bot API —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
6. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî —É—Å–ø–µ—à–Ω—ã—Ö –∏ –Ω–µ—É—Å–ø–µ—à–Ω—ã—Ö —Ä–∞—Å—Å—ã–ª–æ–∫

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

- **Asyncio** ‚Äî –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º (semaphore)
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ —á–µ—Ä–µ–∑ logging
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∏** ‚Äî –∏–∑ .env (TELEGRAM_BOT_TOKEN, SUPABASE_URL, SUPABASE_KEY)
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** ‚Äî graceful handling —Å fallback

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# .env —Ñ–∞–π–ª –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
TELEGRAM_BOT_TOKEN=your_bot_token_here
SUPABASE_URL=your_supabase_url
SUPABASE_KEY=your_supabase_key
OPENAI_API_KEY=your_openai_key  # –¥–ª—è AI –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤
```

### –ó–∞–ø—É—Å–∫

```bash
# –ó–∞–ø—É—Å–∫ –æ—Å–Ω–æ–≤–Ω–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏
python tools/send_daily_digests.py

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π
python tools/test_daily_digests.py
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ cron

```bash
# –î–æ–±–∞–≤–∏—Ç—å –≤ crontab –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ 9:00 Warsaw time
0 9 * * * cd /path/to/news_ai_bot && python tools/send_daily_digests.py >> logs/daily_digests.log 2>&1
```

---

## üîß –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### TelegramSender

–ö–ª–∞—Å—Å –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ Telegram Bot API:

```python
telegram_sender = TelegramSender(bot_token)
success = await telegram_sender.send_message(chat_id, text, parse_mode="HTML")
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π (4000 —Å–∏–º–≤–æ–ª–æ–≤)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ timeout –∏ –æ—à–∏–±–æ–∫ API
- HTML parsing –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

#### `get_current_hour_warsaw() -> int`
–ü–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—É—â–∏–π —á–∞—Å –≤ —á–∞—Å–æ–≤–æ–º –ø–æ—è—Å–µ Europe/Warsaw.

#### `get_users_for_digest(notif_svc, target_hour) -> List[Dict]`
–ü–æ–ª—É—á–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º–∏ –¥–∞–π–¥–∂–µ—Å—Ç–∞–º–∏ –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π —á–∞—Å.

#### `get_user_subscriptions(subs_svc, user_id) -> List[str]`
–ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø–æ–¥–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π.

#### `fetch_news_by_categories(categories, limit) -> List[NewsItem]`
–ü–æ–ª—É—á–∞–µ—Ç —Å–≤–µ–∂–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ –ø–æ —É–∫–∞–∑–∞–Ω–Ω—ã–º –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º.

#### `generate_personalized_digest(news_items, categories, style) -> str`
–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–∞–π–¥–∂–µ—Å—Ç —Å AI –∏–ª–∏ fallback.

#### `send_personalized_digest(user, subs_svc, telegram_sender) -> bool`
–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–∞–π–¥–∂–µ—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

---

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≤–µ–¥–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏:

```
2025-10-02 09:00:01 - tools.send_daily_digests - INFO - üöÄ –ó–∞–ø—É—Å–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤
2025-10-02 09:00:02 - tools.send_daily_digests - INFO - ‚è∞ –¢–µ–∫—É—â–∏–π —á–∞—Å (Europe/Warsaw): 9
2025-10-02 09:00:03 - tools.send_daily_digests - INFO - üë• –ù–∞–π–¥–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: 5
2025-10-02 09:00:05 - tools.send_daily_digests - INFO - ‚úÖ –î–∞–π–¥–∂–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é 123456789
2025-10-02 09:00:10 - tools.send_daily_digests - INFO - üìä –†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å—Å—ã–ª–∫–∏:
2025-10-02 09:00:10 - tools.send_daily_digests - INFO -    ‚úÖ –£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: 4
2025-10-02 09:00:10 - tools.send_daily_digests - INFO -    ‚ùå –û—à–∏–±–æ–∫: 1
2025-10-02 09:00:10 - tools.send_daily_digests - INFO -    üìà –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 5
```

---

## ‚ö†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

- **–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** ‚Äî –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –∏ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è gracefully
- **–ù–µ—Ç –ø–æ–¥–ø–∏—Å–æ–∫** ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è
- **–ù–µ—Ç –Ω–æ–≤–æ—Å—Ç–µ–π** ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
- **–û—à–∏–±–∫–∏ API** ‚Äî –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –∏ –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—é—Ç —Ä–∞—Å—Å—ã–ª–∫—É –¥—Ä—É–≥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- **Timeout** ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏

---

## üé® –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è

–î–∞–π–¥–∂–µ—Å—Ç—ã –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –ø–æ:

1. **–ö–∞—Ç–µ–≥–æ—Ä–∏—è–º –ø–æ–¥–ø–∏—Å–æ–∫** ‚Äî —Ç–æ–ª—å–∫–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏
2. **–°—Ç–∏–ª—é –¥–∞–π–¥–∂–µ—Å—Ç–∞** ‚Äî –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π, –±–∏–∑–Ω–µ—Å, –º–µ–º–Ω—ã–π
3. **–ö–æ–ª–∏—á–µ—Å—Ç–≤—É –Ω–æ–≤–æ—Å—Ç–µ–π** ‚Äî –º–∞–∫—Å–∏–º—É–º 8 –Ω–æ–≤–æ—Å—Ç–µ–π
4. **AI-–∞–Ω–∞–ª–∏–∑—É** ‚Äî —Å fallback –Ω–∞ –ø—Ä–æ—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫

### –°—Ç–∏–ª–∏ –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤

#### üìä –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π —Å—Ç–∏–ª—å
- –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Å–æ–±—ã—Ç–∏–π
- –≠–∫—Å–ø–µ—Ä—Ç–Ω—ã–µ –º–Ω–µ–Ω–∏—è
- –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è

#### üíº –ë–∏–∑–Ω–µ—Å —Å—Ç–∏–ª—å
- –§–æ–∫—É—Å –Ω–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –∞—Å–ø–µ–∫—Ç–∞—Ö
- –í–ª–∏—è–Ω–∏–µ –Ω–∞ —Ä—ã–Ω–∫–∏
- –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

#### üòÑ –ú–µ–º–Ω—ã–π —Å—Ç–∏–ª—å
- –õ–µ–≥–∫–∏–π –∏ —é–º–æ—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π —Ç–æ–Ω
- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –º–µ–º—ã –∏ –æ—Ç—Å—ã–ª–∫–∏
- –ü—Ä–æ—Å—Ç–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —Å–ª–æ–∂–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- **Rate limiting** ‚Äî semaphore –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
- **–ü–∞—É–∑—ã** ‚Äî –º–µ–∂–¥—É –æ—Ç–ø—Ä–∞–≤–∫–∞–º–∏ –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è —Å–ø–∞–º–∞
- **–í–∞–ª–∏–¥–∞—Ü–∏—è** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **Graceful degradation** ‚Äî fallback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö AI

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:

- **–õ–æ–≥–∏** ‚Äî —Ä–µ–≥—É–ª—è—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ—à–∏–±–∫–∏
- **–ú–µ—Ç—Ä–∏–∫–∏** ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö/–Ω–µ—É—Å–ø–µ—à–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- **–ê–ª–µ—Ä—Ç—ã** ‚Äî –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ä–∞—Å—Å—ã–ª–∫–∏

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏

- **–£—Å–ø–µ—à–Ω–æ—Å—Ç—å —Ä–∞—Å—Å—ã–ª–∫–∏** ‚Äî –ø—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤
- **–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏** ‚Äî —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
- **–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º–∏ –¥–∞–π–¥–∂–µ—Å—Ç–∞–º–∏
- **–ö–∞—á–µ—Å—Ç–≤–æ AI** ‚Äî –ø—Ä–æ—Ü–µ–Ω—Ç –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é AI

---

## üéØ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- `services/notification_service.py` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
- `services/subscription_service.py` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏
- `services/digest_ai_service.py` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è AI –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤
- `utils/telegram_sender.py` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- `database/service.py` - —Ä–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `.env` —Ñ–∞–π–ª–µ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã.

---

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞ –¥–ª—è PulseAI - —É–º–Ω–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤ –Ω–æ–≤–æ—Å—Ç–µ–π*
