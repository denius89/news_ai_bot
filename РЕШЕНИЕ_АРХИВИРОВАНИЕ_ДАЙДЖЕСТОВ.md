# –†–µ—à–µ–Ω–∏–µ: –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

**–•–æ—Ä–æ—à–∏–µ –Ω–æ–≤–æ—Å—Ç–∏!** –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤ **–ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç**.

### ‚úÖ –ß—Ç–æ –±—ã–ª–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ:

1. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** ‚Äî –∫–æ–ª–æ–Ω–∫–∏ `archived` –∏ `deleted_at` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç ‚úÖ
2. **–§—É–Ω–∫—Ü–∏–∏ –ë–î** ‚Äî –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ ‚úÖ
3. **API endpoints** ‚Äî —Å—É—â–µ—Å—Ç–≤—É—é—Ç –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã ‚úÖ
4. **–ö–æ–¥ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞** ‚Äî –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã ‚úÖ

### ‚ùì –í —á–µ–º –ø—Ä–æ–±–ª–µ–º–∞?

–ü—Ä–æ–±–ª–µ–º–∞ –≤ **–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏**. API endpoints –∑–∞—â–∏—â–µ–Ω—ã –∏ —Ç—Ä–µ–±—É—é—Ç –≤–∞–ª–∏–¥–Ω—ã–π —Ç–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Telegram WebApp.

**–û—à–∏–±–∫–∞ –≤ –ª–æ–≥–∞—Ö:**
```
Authentication failed for /api/digests/.../archive: 
Authentication failed: no valid method found
```

## üîß –†–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –û–±–Ω–æ–≤–∏—Ç—å WebApp (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. **–ó–∞–∫—Ä–æ–π—Ç–µ Telegram WebApp** (–ø–æ–ª–Ω–æ—Å—Ç—å—é)
2. **–û—Ç–∫—Ä–æ–π—Ç–µ –µ–≥–æ –∑–∞–Ω–æ–≤–æ** —á–µ—Ä–µ–∑ –±–æ—Ç–∞
3. –¢–æ–∫–µ–Ω –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å/—É–¥–∞–ª–∏—Ç—å –¥–∞–π–¥–∂–µ—Å—Ç —Å–Ω–æ–≤–∞

### –í–∞—Ä–∏–∞–Ω—Ç 2: –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞

–ï—Å–ª–∏ –í–∞—Ä–∏–∞–Ω—Ç 1 –Ω–µ –ø–æ–º–æ–≥:

1. –û—Ç–∫—Ä–æ–π—Ç–µ **DevTools** –≤ –±—Ä–∞—É–∑–µ—Ä–µ (F12)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Application** ‚Üí **Storage**
3. –ù–∞–∂–º–∏—Ç–µ **Clear Site Data**
4. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)
5. –°–Ω–æ–≤–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ WebApp —á–µ—Ä–µ–∑ Telegram

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é

–í –±—Ä–∞—É–∑–µ—Ä–Ω–æ–π –∫–æ–Ω—Å–æ–ª–∏ (DevTools ‚Üí Console) –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```javascript
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
console.log('User ID:', localStorage.getItem('pulseai_auth'));
console.log('Telegram WebApp:', window.Telegram?.WebApp);
```

–ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç ‚Äî –Ω—É–∂–Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è.

## üìã –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ init_tables.sql

–§–∞–π–ª `database/init_tables.sql` —Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞–µ—Ç –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è:

```sql
CREATE TABLE IF NOT EXISTS digests (
  id         uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id    uuid REFERENCES users(id) ON DELETE CASCADE,
  summary    text,
  created_at timestamptz DEFAULT now(),
  deleted_at timestamptz,
  archived   boolean DEFAULT FALSE
);
```

–≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Ö–µ–º—É –¥–ª—è –Ω–æ–≤—ã—Ö —É—Å—Ç–∞–Ω–æ–≤–æ–∫.

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–§–∞–π–ª `database/MIGRATION_INSTRUCTIONS.md` –¥–æ–ø–æ–ª–Ω–µ–Ω –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏ soft delete –¥–ª—è –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤.

### 3. –°–æ–∑–¥–∞–Ω –æ—Ç—á–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

–ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤ `DIGEST_ARCHIVE_DELETE_REPORT.md`.

## üîç –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –ü–æ—á–µ–º—É —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è?

Endpoints –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤ **–∑–∞—â–∏—â–µ–Ω—ã** –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:

```python
# src/webapp.py
@app.before_request
def authenticate_request():
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –¥–ª—è –≤—Å–µ—Ö –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö endpoints."""
    # –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —Ç—Ä–µ–±—É—é—Ç –≤–∞–ª–∏–¥–Ω—ã–π Telegram —Ç–æ–∫–µ–Ω
```

### –ú–µ—Ç–æ–¥—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç):

1. **HMAC SHA256** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ Telegram (—Å—Ä–æ–∫: 24 —á–∞—Å–∞)
2. **Session** ‚Äî Flask session –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ HMAC
3. **Fallback JSON** ‚Äî –∑–∞–ø–∞—Å–Ω–æ–π –º–µ—Ç–æ–¥ (–º–µ–Ω–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π)

### –ü–æ—á–µ–º—É —Ç–æ–∫–µ–Ω –∏—Å—Ç–µ–∫–∞–µ—Ç?

Telegram —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç **24-—á–∞—Å–æ–≤–æ–π —Å—Ä–æ–∫** –¥–ª—è `initData`. –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

## üöÄ –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π –ë–î (–±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏)
python3 -c "from database.db_models import archive_digest; \
print(archive_digest('digest_id', 'user_id'))"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ API (—Ç—Ä–µ–±—É–µ—Ç —Ç–æ–∫–µ–Ω)
curl -X POST "http://localhost:8001/api/digests/<ID>/archive?user_id=<UUID>" \
  -H "X-Telegram-Init-Data: <VALID_TOKEN>"
```

### –î–æ–±–∞–≤–∏—Ç—å dev-—Ä–µ–∂–∏–º (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ `src/webapp.py`:

```python
if os.getenv("DEV_MODE") == "true":
    # –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –≤ dev
    return None
```

–ù–æ **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ** —ç—Ç–æ –≤ production!

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –≤—Å–µ—Ö —à–∞–≥–æ–≤:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Flask: `tail -100 logs/webapp.log | grep -i auth`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ë–î:

```sql
SELECT id, telegram_id, created_at 
FROM users 
WHERE telegram_id = <YOUR_TELEGRAM_ID>;
```

---

**–î–∞—Ç–∞:** 15 –æ–∫—Ç—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ—à–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ

