{% extends "base.html" %}

{% block content %}
<style>
    .live-dashboard {
        padding: 2rem 0;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: white;
    }
    
    .dashboard-header {
        text-align: center;
        margin-bottom: 3rem;
    }
    
    .dashboard-title {
        font-size: 3rem;
        font-weight: 700;
        margin-bottom: 1rem;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    
    .dashboard-subtitle {
        font-size: 1.2rem;
        opacity: 0.9;
        margin-bottom: 2rem;
    }
    
    .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 2rem;
    }
    
    .dashboard-card {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 16px;
        padding: 2rem;
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: all 0.3s ease;
    }
    
    .dashboard-card:hover {
        transform: translateY(-5px);
        background: rgba(255, 255, 255, 0.15);
    }
    
    .card-title {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .card-icon {
        font-size: 1.8rem;
    }
    
    .metrics-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        margin-bottom: 1.5rem;
    }
    
    .metric-item {
        text-align: center;
        padding: 1rem;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
    }
    
    .metric-value {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }
    
    .metric-label {
        font-size: 0.9rem;
        opacity: 0.8;
    }
    
    .status-indicator {
        display: inline-block;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: 500;
        margin-bottom: 1rem;
    }
    
    .status-connected {
        background: rgba(34, 197, 94, 0.3);
        border: 1px solid rgba(34, 197, 94, 0.5);
    }
    
    .status-disconnected {
        background: rgba(239, 68, 68, 0.3);
        border: 1px solid rgba(239, 68, 68, 0.5);
    }
    
    .events-feed {
        max-height: 300px;
        overflow-y: auto;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 8px;
        padding: 1rem;
    }
    
    .event-item {
        padding: 0.75rem;
        margin-bottom: 0.5rem;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 6px;
        border-left: 3px solid #3b82f6;
        animation: slideIn 0.3s ease-out;
    }
    
    .event-item.new {
        border-left-color: #10b981;
        background: rgba(16, 185, 129, 0.2);
    }
    
    .event-item.error {
        border-left-color: #ef4444;
        background: rgba(239, 68, 68, 0.2);
    }
    
    .event-title {
        font-weight: 600;
        margin-bottom: 0.25rem;
    }
    
    .event-time {
        font-size: 0.8rem;
        opacity: 0.7;
    }
    
    .pulse-animation {
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0% {
            opacity: 1;
        }
        50% {
            opacity: 0.5;
        }
        100% {
            opacity: 1;
        }
    }
    
    @keyframes slideIn {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
    
    .controls {
        display: flex;
        gap: 1rem;
        justify-content: center;
        margin-top: 2rem;
    }
    
    .btn {
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        border: none;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .btn-primary {
        background: rgba(59, 130, 246, 0.8);
        color: white;
    }
    
    .btn-primary:hover {
        background: rgba(59, 130, 246, 1);
    }
    
    .btn-secondary {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.3);
    }
    
    .btn-secondary:hover {
        background: rgba(255, 255, 255, 0.3);
    }
    
    @media (max-width: 768px) {
        .dashboard-title {
            font-size: 2rem;
        }
        
        .dashboard-grid {
            grid-template-columns: 1fr;
            padding: 0 1rem;
        }
        
        .dashboard-card {
            padding: 1.5rem;
        }
        
        .metrics-grid {
            grid-template-columns: 1fr;
        }
    }
</style>

<div class="live-dashboard">
    <div class="dashboard-header">
        <h1 class="dashboard-title">‚ö° PulseAI Live Dashboard</h1>
        <p class="dashboard-subtitle">–†–µ–∞–∫—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</p>
        
        <!-- Connection Status -->
        <div class="status-indicator" data-reactor="connection-status">
            <span class="pulse-animation">üîó</span> –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...
        </div>
    </div>
    
    <div class="dashboard-grid">
        <!-- AI Metrics Card -->
        <div class="dashboard-card">
            <h3 class="card-title">
                <span class="card-icon">üß†</span>
                AI –ú–µ—Ç—Ä–∏–∫–∏
            </h3>
            
            <div class="metrics-grid" data-reactor="metrics">
                <div class="metric-item">
                    <div class="metric-value" data-metric="credibility">--%</div>
                    <div class="metric-label">–î–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç—å</div>
                </div>
                <div class="metric-item">
                    <div class="metric-value" data-metric="importance">--%</div>
                    <div class="metric-label">–í–∞–∂–Ω–æ—Å—Ç—å</div>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 1rem;">
                <div class="metric-label" data-metric="timestamp">–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: --</div>
            </div>
        </div>
        
        <!-- News Processing Card -->
        <div class="dashboard-card">
            <h3 class="card-title">
                <span class="card-icon">üì∞</span>
                –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π
            </h3>
            
            <div class="metrics-grid">
                <div class="metric-item">
                    <div class="metric-value" data-reactor="news-counter">0</div>
                    <div class="metric-label">–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ</div>
                </div>
                <div class="metric-item">
                    <div class="metric-value" id="processing-time">0s</div>
                    <div class="metric-label">–í—Ä–µ–º—è</div>
                </div>
            </div>
            
            <div style="margin-top: 1rem;">
                <span data-reactor="digest-status" class="status-indicator status-connected">–ì–æ—Ç–æ–≤</span>
            </div>
        </div>
        
        <!-- System Health Card -->
        <div class="dashboard-card">
            <h3 class="card-title">
                <span class="card-icon">üíö</span>
                –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
            </h3>
            
            <div class="metrics-grid">
                <div class="metric-item">
                    <div class="metric-value" data-reactor="system-status">OK</div>
                    <div class="metric-label">–°—Ç–∞—Ç—É—Å</div>
                </div>
                <div class="metric-item">
                    <div class="metric-value" id="uptime">0m</div>
                    <div class="metric-label">–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã</div>
                </div>
            </div>
            
            <div style="margin-top: 1rem;">
                <div class="metric-label">–ü–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞: <span id="last-health-check">--</span></div>
            </div>
        </div>
        
        <!-- Events Feed Card -->
        <div class="dashboard-card">
            <h3 class="card-title">
                <span class="card-icon">üì°</span>
                –õ–µ–Ω—Ç–∞ —Å–æ–±—ã—Ç–∏–π
            </h3>
            
            <div class="events-feed" data-reactor="events-container">
                <div class="event-item">
                    <div class="event-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ PulseAI Reactor!</div>
                    <div class="event-time">–°–∏—Å—Ç–µ–º–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Controls -->
    <div class="controls">
        <button class="btn btn-primary" onclick="testEvent()">üéØ –¢–µ—Å—Ç —Å–æ–±—ã—Ç–∏–µ</button>
        <button class="btn btn-secondary" onclick="pingReactor()">üì° Ping Reactor</button>
        <button class="btn btn-secondary" onclick="toggleNotifications()">üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</button>
    </div>
</div>

<script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è live dashboard
    function initPageReactor() {
        console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Reactor –¥–ª—è Live Dashboard');
        
        if (window.reactor) {
            // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –≤—Å–µ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
            window.reactor.on('ai_metrics_updated', function(data) {
                console.log('AI –º–µ—Ç—Ä–∏–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã:', data);
                addEventToFeed('AI –º–µ—Ç—Ä–∏–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã', 'success');
            });
            
            window.reactor.on('news_processed', function(data) {
                console.log('–ù–æ–≤–æ—Å—Ç–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã:', data);
                document.getElementById('processing-time').textContent = data.processing_time + 's';
                addEventToFeed(`–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ ${data.count} –Ω–æ–≤–æ—Å—Ç–µ–π`, 'info');
            });
            
            window.reactor.on('digest_created', function(data) {
                console.log('–î–∞–π–¥–∂–µ—Å—Ç —Å–æ–∑–¥–∞–Ω:', data);
                addEventToFeed(`–î–∞–π–¥–∂–µ—Å—Ç "${data.title}" —Å–æ–∑–¥–∞–Ω`, 'success');
            });
            
            window.reactor.on('event_detected', function(data) {
                console.log('–°–æ–±—ã—Ç–∏–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ:', data);
                if (data.title) {
                    addEventToFeed(`–°–æ–±—ã—Ç–∏–µ: ${data.title}`, 'info');
                }
            });
            
            window.reactor.on('system_health_check', function(data) {
                console.log('–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã:', data);
                document.getElementById('last-health-check').textContent = new Date().toLocaleTimeString();
                addEventToFeed('–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã', 'info');
            });
            
            window.reactor.on('reactor_heartbeat', function(data) {
                console.log('Heartbeat Reactor:', data);
                updateUptime();
            });
            
            window.reactor.on('reactor_connected', function(data) {
                console.log('Reactor –ø–æ–¥–∫–ª—é—á–µ–Ω:', data);
                addEventToFeed('–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Reactor —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ', 'success');
            });
            
            window.reactor.on('reactor_disconnected', function(data) {
                console.log('Reactor –æ—Ç–∫–ª—é—á–µ–Ω:', data);
                addEventToFeed('–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å Reactor –ø–æ—Ç–µ—Ä—è–Ω–æ', 'error');
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º uptime –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
            setInterval(updateUptime, 1000);
        }
    }
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    function testEvent() {
        if (window.reactor) {
            window.reactor.emit('test_event', {
                message: '–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ',
                timestamp: Date.now()
            });
            addEventToFeed('–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ', 'info');
        }
    }
    
    function pingReactor() {
        if (window.reactor) {
            window.reactor.ping();
            addEventToFeed('Ping –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω', 'info');
        }
    }
    
    function toggleNotifications() {
        const notifications = document.querySelector('.reactor-notifications');
        if (notifications) {
            notifications.style.display = notifications.style.display === 'none' ? 'block' : 'none';
        }
        addEventToFeed('–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω—ã', 'info');
    }
    
    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    function addEventToFeed(title, type = 'info') {
        const container = document.querySelector('[data-reactor="events-container"]');
        if (!container) return;
        
        const eventElement = document.createElement('div');
        eventElement.className = `event-item ${type}`;
        eventElement.innerHTML = `
            <div class="event-title">${title}</div>
            <div class="event-time">${new Date().toLocaleTimeString()}</div>
        `;
        
        container.insertBefore(eventElement, container.firstChild);
        
        // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–±—ã—Ç–∏–π
        const events = container.querySelectorAll('.event-item');
        if (events.length > 10) {
            events[events.length - 1].remove();
        }
    }
    
    function updateUptime() {
        const uptimeElement = document.getElementById('uptime');
        if (uptimeElement && window.reactor) {
            const status = window.reactor.getStatus();
            const uptimeSeconds = status.uptime || 0;
            const minutes = Math.floor(uptimeSeconds / 60);
            const seconds = Math.floor(uptimeSeconds % 60);
            uptimeElement.textContent = `${minutes}m ${seconds}s`;
        }
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    document.addEventListener('DOMContentLoaded', function() {
        updateUptime();
    });
</script>
{% endblock %}
