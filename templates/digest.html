{% extends "base.html" %}

{% block subnav %}
<div class="subnav">
    <div class="categories-chips">
        {% for cat in all_categories %}
            {% set is_active = cat in active_categories %}
            {% set new_categories = active_categories.copy() %}
            {% if is_active %}
                {% set _ = new_categories.remove(cat) %}
            {% else %}
                {% set _ = new_categories.append(cat) %}
            {% endif %}

            <a href="/digest?{% for c in new_categories %}category={{ c }}&{% endfor %}"
               class="chip-filter {{ cat }} {% if is_active %}active{% endif %}">
                <!-- –ò—Å–ø–æ–ª—å–∑—É–µ–º emoji –∏–∑ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
                <span>{{ cat.capitalize() }}</span>
            </a>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block content %}
<div class="container">
    {% for item in news %}
    <div class="news-card">
        <!-- –ò—Å—Ç–æ—á–Ω–∏–∫ –∏ –¥–∞—Ç–∞ -->
        <div class="news-card__meta">
            <div class="news-card__source">
                <span class="news-card__source-icon">üóûÔ∏è</span>
                <span class="news-card__source-name">{{ item.source }}</span>
            </div>
            <div class="news-card__date">{{ item.published_at_fmt or "‚Äî" }}</div>
        </div>

        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <h2 class="news-card__title">
            <a href="{{ item.link }}" target="_blank" class="news-card__link">
                {{ item.title }}
            </a>
        </h2>

        <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
        <p class="news-card__description">{{ item.content or "–ù–µ—Ç —Ç–µ–∫—Å—Ç–∞" }}</p>

        <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –º–µ—Ç—Ä–∏–∫–∏ -->
        <div class="news-card__footer">
            <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
            <div class="news-card__categories">
                <span class="news-card__category news-card__category--{{ item.category }}">
                    {{ item.category.capitalize() }}
                </span>
                {% if item.subcategory and item.subcategory != 'general' %}
                    <span class="news-card__subcategory">{{ item.subcategory }}</span>
                {% endif %}
            </div>

            <!-- –ú–µ—Ç—Ä–∏–∫–∏ -->
            <div class="news-card__metrics">
                {% set cred = item.get('credibility', 0) %}
                <div class="news-card__metric">
                    <span class="news-card__metric-icon">üìä</span>
                    <span class="news-card__metric-label">Relevance</span>
                    <div class="news-card__progress-bar">
                        <div class="news-card__progress-fill news-card__progress-fill--credibility
                            {% if cred > 0.7 %}high{% elif cred > 0.4 %}medium{% else %}low{% endif %}"
                            style="width: {{ (cred * 100)|round }}%"></div>
                    </div>
                    <span class="news-card__metric-value">{{ (cred * 100)|round }}%</span>
                </div>

                {% set imp = item.get('importance', 0) %}
                <div class="news-card__metric">
                    <span class="news-card__metric-icon">üìà</span>
                    <span class="news-card__metric-label">Trend</span>
                    <div class="news-card__progress-bar">
                        <div class="news-card__progress-fill news-card__progress-fill--importance
                            {% if imp > 0.7 %}high{% elif imp > 0.4 %}medium{% else %}low{% endif %}"
                            style="width: {{ (imp * 100)|round }}%"></div>
                    </div>
                    <span class="news-card__metric-value">{{ (imp * 100)|round }}%</span>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}