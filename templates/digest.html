{% extends "base.html" %}

{% block subnav %}
<div class="subnav">
    <div class="categories-chips">
        {% for cat in all_categories %}
            {% set is_active = cat in active_categories %}
            {% set new_categories = active_categories.copy() %}
            {% if is_active %}
                {% set _ = new_categories.remove(cat) %}
            {% else %}
                {% set _ = new_categories.append(cat) %}
            {% endif %}

            <a href="/digest?{% for c in new_categories %}category={{ c }}&{% endfor %}"
               class="chip-filter {{ cat }} {% if is_active %}active{% endif %}">
                {% if cat == "crypto" %}📊{% elif cat == "economy" %}💰
                {% elif cat == "world" %}🌍{% elif cat == "technology" %}⚙️
                {% elif cat == "politics" %}🏛️{% endif %}
                <span>{{ cat.capitalize() }}</span>
            </a>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block content %}
<div class="container">
    {% for item in news %}
    <div class="card">
        <!-- Заголовок -->
        <h2 class="card-title card-title--calm">
            <a href="{{ item.link }}" target="_blank" class="card-link">
                {{ item.title }}
            </a>
        </h2>

        <!-- Дата -->
        <div class="card-date">{{ item.published_at_fmt or "—" }}</div>

        <!-- Краткое содержание -->
        <p class="card-summary">{{ item.content or "Нет текста" }}</p>

        <!-- Футер -->
        <div class="card-footer">
            <span class="source-link">{{ item.source }}</span> ·
            <span class="card-category">{{ item.category or "—" }}</span> ·

            {% set cred = item.get('credibility', 0) %}
            <span class="credibility-value
                {% if cred > 0.7 %}high
                {% elif cred > 0.4 %}medium
                {% else %}low{% endif %}">
                {% if cred > 0.7 %}
                    ✅ {{ "%.2f"|format(cred) }}
                {% elif cred > 0.4 %}
                    ⚠️ {{ "%.2f"|format(cred) }}
                {% else %}
                    ❌ {{ "%.2f"|format(cred) }}
                {% endif %}
            </span> ·

            {% set imp = item.get('importance', 0) %}
            <span class="importance-value
                {% if imp > 0.7 %}high
                {% elif imp > 0.4 %}medium
                {% else %}low{% endif %}">
                🔥 {{ "%.2f"|format(imp) }}
            </span>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}